<!DOCTYPE html>
<html>
<head>
   <meta charset="utf-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
   <meta http-equiv="description" content="index.html">
   <meta http-equiv="keywords" content="tl-verilog">

   <title>top.m4 -> top.sv & top_gen.sv</title>

   <link rel="stylesheet" href="tlx.css" />
<!--Load styles for stats page-->
<link rel="stylesheet" href="http://www.rweda.com/lib/sp_1.9-2018_02_11-beta/stats.css" />
<!--Load the AJAX API-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript" src="http://www.rweda.com/lib/sp_1.9-2018_02_11-beta/stats.js"></script>
<script type="text/javascript">

  function getTitle() {
    return "top.m4 -> top.sv & top_gen.sv";
  }

  function chartData() {
    return [
      ['File(s)', 'Unknown', 'Untouched', 'Logic', 'Declarations', 'Staging', 'Structure', 'Validity', 'Gating', '(Instrumentation)', { role: 'style' }, '(Comments)', { role: 'style' }, '(Whitespace)', { role: 'style' }],
      ['top.m4', 0, 286, 957, 0, 10, 46, 28, 0, 0, 'opacity: 0.1', 1411, 'opacity: 0.1', 930, 'opacity: 0.1'],
      ['top.sv', 0, 286, 1307, 0, 0, 70, 0, 0, 0, 'opacity: 0.1', 1581, 'opacity: 0.1', 950, 'opacity: 0.1'],
      ['top_gen.sv', 0, 0, 0, 753, 1552, 72, 0, 561, 883, 'opacity: 0.1', 1081, 'opacity: 0.1', 1098, 'opacity: 0.1'],
      ['SV Total', 0, 286, 1307, 753, 1552, 142, 0, 561, 883, 'opacity: 0.1', 2662, 'opacity: 0.1', 2048, 'opacity: 0.1']
    ];
  }

  function chartColors() {
    return ['DarkGray', '#305050', 'purple', 'blue', '#509050', '#1090c0', '#E04010', 'orange', '#C0C0F0', '#C04040', 'gray'];
  };
</script>
</head>

<body>

    <div id="four_square">
        <div id="chart_div" class="cell left top"></div>
        <div id="gen_div" class="cell code right top">
<h2>top_gen.sv</h2>

<pre>
<span class="tlx_comments">// Generated by SandPiper(TM) 1.9-2018/02/11-beta from Redwood EDA.
// (Installed here: /home/devel/SandPiper_1.9-2018_02_11-beta_distro.)
// Redwood EDA does not claim intellectual property rights to this file and provides no warranty regarding its correctness or quality.


</span><span class="tlx_structure">`include &quot;sandpiper_gen.vh&quot;





</span><span class="tlx_comments">//
// Signals declared top-level.
//

// For |bank$Balance.
</span><span class="tlx_declarations">logic [15:0] BANK_Balance_a1,
             BANK_Balance_a2,
             BANK_Balance_a3;
logic [15:15] BANK_Balance_a4;

</span><span class="tlx_comments">// For |bank$CycCount.
</span><span class="tlx_declarations">logic [15:0] BANK_CycCount_a3,
             BANK_CycCount_a4;

</span><span class="tlx_comments">// For |bank$NumTransactions.
</span><span class="tlx_declarations">logic [15:0] BANK_NumTransactions_a1,
             BANK_NumTransactions_a2,
             BANK_NumTransactions_a3;

</span><span class="tlx_comments">// For |bank$action.
</span><span class="tlx_declarations">logic [0:0] BANK_action_a1,
            BANK_action_a2,
            BANK_action_a3;

</span><span class="tlx_comments">// For |bank$amount.
</span><span class="tlx_declarations">logic [15:0] BANK_amount_a1,
             BANK_amount_a2,
             BANK_amount_a3;

</span><span class="tlx_comments">// For |bank$init_balance.
</span><span class="tlx_declarations">logic [15:0] BANK_init_balance_a1,
             BANK_init_balance_a2;

</span><span class="tlx_comments">// For |bank$rand_amount.
</span><span class="tlx_declarations">logic [10:0] BANK_rand_amount_a1;

</span><span class="tlx_comments">// For |bank$reset.
</span><span class="tlx_declarations">logic BANK_reset_a0,
      BANK_reset_a1,
      BANK_reset_a2,
      BANK_reset_a3,
      BANK_reset_a4;

</span><span class="tlx_comments">// For |bank$transaction.
</span><span class="tlx_declarations">logic [1:0] BANK_transaction_a1,
            BANK_transaction_a2;

</span><span class="tlx_comments">// For |bank$valid_transaction.
</span><span class="tlx_declarations">logic BANK_valid_transaction_a2,
      BANK_valid_transaction_a3;

</span><span class="tlx_comments">// For |bank$valid_transaction_or_reset.
</span><span class="tlx_declarations">logic BANK_valid_transaction_or_reset_a2,
      BANK_valid_transaction_or_reset_a3,
      BANK_valid_transaction_or_reset_a4;

</span><span class="tlx_comments">// For |bank$withdraw_error.
</span><span class="tlx_declarations">logic BANK_withdraw_error_a2,
      BANK_withdraw_error_a3;

</span><span class="tlx_comments">
//
// Scope: |bank
//

// Clock signals.
</span><span class="tlx_gating">logic clkF_BANK_valid_transaction_or_reset_a3 ;
logic clkF_BANK_valid_transaction_or_reset_a4 ;
logic clkF_BANK_valid_transaction_or_reset_a5 ;

</span><span class="tlx_structure">
generate
</span><span class="tlx_comments">

   //
   // Scope: |bank
   //

      // For $Balance.
      </span><span class="tlx_staging">always_ff @(posedge clkF_BANK_valid_transaction_or_reset_a3) BANK_Balance_a2[15:0] &lt;= BANK_Balance_a1[15:0];
      always_ff @(posedge clkF_BANK_valid_transaction_or_reset_a4) BANK_Balance_a3[15:0] &lt;= BANK_Balance_a2[15:0];
      always_ff @(posedge clkF_BANK_valid_transaction_or_reset_a5) BANK_Balance_a4[15] &lt;= BANK_Balance_a3[15];

      </span><span class="tlx_comments">// For $CycCount.
      </span><span class="tlx_staging">always_ff @(posedge clk) BANK_CycCount_a4[15:0] &lt;= BANK_CycCount_a3[15:0];

      </span><span class="tlx_comments">// For $NumTransactions.
      </span><span class="tlx_staging">always_ff @(posedge clkF_BANK_valid_transaction_or_reset_a3) BANK_NumTransactions_a2[15:0] &lt;= BANK_NumTransactions_a1[15:0];
      always_ff @(posedge clkF_BANK_valid_transaction_or_reset_a4) BANK_NumTransactions_a3[15:0] &lt;= BANK_NumTransactions_a2[15:0];

      </span><span class="tlx_comments">// For $action.
      </span><span class="tlx_staging">always_ff @(posedge clk) BANK_action_a2[0:0] &lt;= BANK_action_a1[0:0];
      always_ff @(posedge clk) BANK_action_a3[0:0] &lt;= BANK_action_a2[0:0];

      </span><span class="tlx_comments">// For $amount.
      </span><span class="tlx_staging">always_ff @(posedge clk) BANK_amount_a2[15:0] &lt;= BANK_amount_a1[15:0];
      always_ff @(posedge clk) BANK_amount_a3[15:0] &lt;= BANK_amount_a2[15:0];

      </span><span class="tlx_comments">// For $init_balance.
      </span><span class="tlx_staging">always_ff @(posedge clk) BANK_init_balance_a2[15:0] &lt;= BANK_init_balance_a1[15:0];

      </span><span class="tlx_comments">// For $reset.
      </span><span class="tlx_staging">always_ff @(posedge clk) BANK_reset_a1 &lt;= BANK_reset_a0;
      always_ff @(posedge clk) BANK_reset_a2 &lt;= BANK_reset_a1;
      always_ff @(posedge clk) BANK_reset_a3 &lt;= BANK_reset_a2;
      always_ff @(posedge clk) BANK_reset_a4 &lt;= BANK_reset_a3;

      </span><span class="tlx_comments">// For $transaction.
      </span><span class="tlx_staging">always_ff @(posedge clk) BANK_transaction_a2[1:0] &lt;= BANK_transaction_a1[1:0];

      </span><span class="tlx_comments">// For $valid_transaction.
      </span><span class="tlx_staging">always_ff @(posedge clk) BANK_valid_transaction_a3 &lt;= BANK_valid_transaction_a2;

      </span><span class="tlx_comments">// For $valid_transaction_or_reset.
      </span><span class="tlx_staging">always_ff @(posedge clk) BANK_valid_transaction_or_reset_a3 &lt;= BANK_valid_transaction_or_reset_a2;
      always_ff @(posedge clk) BANK_valid_transaction_or_reset_a4 &lt;= BANK_valid_transaction_or_reset_a3;

      </span><span class="tlx_comments">// For $withdraw_error.
      </span><span class="tlx_staging">always_ff @(posedge clk) BANK_withdraw_error_a3 &lt;= BANK_withdraw_error_a2;




</span><span class="tlx_structure">endgenerate



</span><span class="tlx_comments">//
// Gated clocks.
//

</span><span class="tlx_structure">generate

</span><span class="tlx_comments">

   //
   // Scope: |bank
   //

</span><span class="tlx_gating">      clk_gate gen_clkF_BANK_valid_transaction_or_reset_a3(clkF_BANK_valid_transaction_or_reset_a3, clk, BANK_valid_transaction_or_reset_a2, 1'b1, 1'b0);
      clk_gate gen_clkF_BANK_valid_transaction_or_reset_a4(clkF_BANK_valid_transaction_or_reset_a4, clk, BANK_valid_transaction_or_reset_a3, 1'b1, 1'b0);
      clk_gate gen_clkF_BANK_valid_transaction_or_reset_a5(clkF_BANK_valid_transaction_or_reset_a5, clk, BANK_valid_transaction_or_reset_a4, 1'b1, 1'b0);



</span><span class="tlx_structure">endgenerate



</span><span class="tlx_comments">//
// Debug Signals
//

</span><span class="tlx_instrumentation">generate

   if (1) begin : DEBUG_SIGS
</span><span class="tlx_comments">

      //
      // Scope: |bank
      //
      </span><span class="tlx_instrumentation">if (1) begin : \|bank 
         logic [15:0] \@1$Balance ;
         assign \@1$Balance = BANK_Balance_a1;
         logic [15:0] \@3$CycCount ;
         assign \@3$CycCount = BANK_CycCount_a3;
         logic [15:0] \@1$NumTransactions ;
         assign \@1$NumTransactions = BANK_NumTransactions_a1;
         logic [0:0] \@1$action ;
         assign \@1$action = BANK_action_a1;
         logic [15:0] \@1$amount ;
         assign \@1$amount = BANK_amount_a1;
         logic [15:0] \@1$init_balance ;
         assign \@1$init_balance = BANK_init_balance_a1;
         logic [10:0] \@1$rand_amount ;
         assign \@1$rand_amount = BANK_rand_amount_a1;
         logic  \@0$reset ;
         assign \@0$reset = BANK_reset_a0;
         logic [1:0] \@1$transaction ;
         assign \@1$transaction = BANK_transaction_a1;
         logic  \@2$valid_transaction ;
         assign \@2$valid_transaction = BANK_valid_transaction_a2;
         logic  \@2$valid_transaction_or_reset ;
         assign \@2$valid_transaction_or_reset = BANK_valid_transaction_or_reset_a2;
         logic  \@2$withdraw_error ;
         assign \@2$withdraw_error = BANK_withdraw_error_a2;
      end


   end

endgenerate




</span><span class="tlx_structure">generate   </span><span class="tlx_comments">// This is awkward, but we need to go into 'generate' context in the line that `includes the declarations file.
</span>
</pre>
        </div>
        <div id="tlx_div" class="cell code left bottom">
<h2>top.m4</h2>

<pre>
<span class="tlx_structure">\TLV_version 1d: tl-x.org
\SV
   </span><span class="tlx_comments">// -------------------------------------------------------------------------------
   // This code implements a bank account balance.
   // Transactions consist of deposits and withdrawals.
   // -------------------------------------------------------------------------------

   </span><span class="tlx_untouched">module top(input logic clk, input logic reset, input logic [31:0] cyc_cnt, output logic passed, output logic failed);    </span><span class="tlx_comments">/* verilator lint_save */ /* verilator lint_off UNOPTFLAT */  </span><span class="tlx_untouched">bit [256:0] RW_rand_raw; bit [256+63:0] RW_rand_vect; pseudo_rand #(.WIDTH(257)) pseudo_rand (clk, reset, RW_rand_raw[256:0]); assign RW_rand_vect[256+63:0] = {RW_rand_raw[62:0], RW_rand_raw};  </span><span class="tlx_comments">/* verilator lint_restore */  /* verilator lint_off WIDTH */ /* verilator lint_off UNOPTFLAT */   // A generic module declaration macro instantiation
      // Note: We do not ignore width mismatch in this example.
</span><span class="tlx_structure">\TLV

   |bank
      </span><span class="tlx_staging">@0
         </span><span class="tlx_logic">$reset = *reset;
      

      </span><span class="tlx_comments">// ----------------------------------------------------------------------------
      // Explicitly assign inputs.
      // Assign/randomize initial balance, account action, and amount to deposit or withdraw
      // ----------------------------------------------------------------------------
      </span><span class="tlx_staging">@1
         </span><span class="tlx_logic">$init_balance[15:0] = 16'b1; </span><span class="tlx_comments">// initial balance
         </span><span class="tlx_logic">$action[0:0] = *RW_rand_vect[(0 + (0)) % 257 +: 1];       </span><span class="tlx_comments">// deposit = 0; withdrawal = 1
         </span><span class="tlx_logic">$transaction[1:0] = *RW_rand_vect[(124 + (0)) % 257 +: 2];  </span><span class="tlx_comments">// 75% chance of valid (01, 10, 11); 25% chance of invalid (00)
         </span><span class="tlx_logic">$rand_amount[10:0] = *RW_rand_vect[(248 + (0)) % 257 +: 11]; </span><span class="tlx_comments">// amount to deposit or withdraw
         </span><span class="tlx_logic">$amount[15:0] = {5'b0, $rand_amount};


      </span><span class="tlx_comments">// ---
      // DUT
      // ---
      </span><span class="tlx_staging">@2
         </span><span class="tlx_logic">$valid_transaction = $transaction != 2'b0;
         $withdraw_error = $action == 1'b1 &amp;&amp; $amount &gt; $Balance ? 1'b1 : </span><span class="tlx_comments">// true if withdrawal amount is greater than current balance
                                                                   </span><span class="tlx_logic">1'b0;  </span><span class="tlx_comments">// false otherwise
         </span><span class="tlx_logic">$valid_transaction_or_reset = ($valid_transaction &amp;&amp; !$withdraw_error) || $reset;
         
         </span><span class="tlx_validity">?$valid_transaction_or_reset
            </span><span class="tlx_logic">$Balance[15:0] &lt;= $reset          ? $init_balance :      </span><span class="tlx_comments">// set to init_balance at the beginning
                              </span><span class="tlx_logic">$action == 1'b0 ? $Balance + $amount : </span><span class="tlx_comments">// deposit amount
                                                </span><span class="tlx_logic">$Balance - $amount;  </span><span class="tlx_comments">// withdraw amount
            
            //$NumTransactions[15:0] = 16'b0; to count how many successful transactions occur.
            </span><span class="tlx_logic">$NumTransactions[15:0] &lt;= $reset ? 16'b0 :$NumTransactions + 16'b1;

      </span><span class="tlx_comments">// -----------------
      // Print transaction
      // -----------------
      </span><span class="tlx_staging">@3
         </span><span class="tlx_structure">\SV_plus
            </span><span class="tlx_logic">always_ff @(posedge clk) begin
               if ($valid_transaction &amp;&amp; ! $reset) begin
                  if (!$withdraw_error) begin
                     \$display(&quot; NumTransaction #: \%0d&quot;, $NumTransactions);
                     \$display(&quot;     \$\%5d \%0s\ $\%4d = \$\%5d&quot;, $Balance, $action == 1'b0 ? &quot;+&quot; : &quot;-&quot;, $amount, &lt;&lt;1$Balance);
                  end else begin
                     \$display(&quot; Insufficient funds. Balance: \$\%5d Withdrawal: \$\%4d&quot;, &lt;&lt;1$Balance, $amount);
                  end
               end
            end
      

      </span><span class="tlx_comments">// ---------------------------------------------------
      // Test for Positive Remaining Balance after 20 Cycles
      // ---------------------------------------------------
      </span><span class="tlx_staging">@4
         </span><span class="tlx_logic">$CycCount[15:0] &lt;= $reset ? 16'b0 : $CycCount + 16'b1;
           
         *passed = $Balance[15] == 1'b0 &amp;&amp; $CycCount &gt; 16'd20;

</span><span class="tlx_structure">\SV
</span><span class="tlx_untouched">endmodule
</span>
</pre>
        </div>
        <div id="trans_div" class="cell code right bottom">
<h2>top.sv</h2>

<pre>
<span class="tlx_structure">`line 2 &quot;top.tlv&quot; 0 </span><span class="tlx_comments">//_\TLV_version 1d: tl-x.org, generated by SandPiper(TM) 1.9-2018/02/11-beta
</span><span class="tlx_structure">`include &quot;sp_default.vh&quot; </span><span class="tlx_comments">//_\SV
   // -------------------------------------------------------------------------------
   // This code implements a bank account balance.
   // Transactions consist of deposits and withdrawals.
   // -------------------------------------------------------------------------------

   </span><span class="tlx_untouched">module top(input logic clk, input logic reset, input logic [31:0] cyc_cnt, output logic passed, output logic failed);    </span><span class="tlx_comments">/* verilator lint_save */ /* verilator lint_off UNOPTFLAT */  </span><span class="tlx_untouched">bit [256:0] RW_rand_raw; bit [256+63:0] RW_rand_vect; pseudo_rand #(.WIDTH(257)) pseudo_rand (clk, reset, RW_rand_raw[256:0]); assign RW_rand_vect[256+63:0] = {RW_rand_raw[62:0], RW_rand_raw};  </span><span class="tlx_comments">/* verilator lint_restore */  /* verilator lint_off WIDTH */ /* verilator lint_off UNOPTFLAT */   // A generic module declaration macro instantiation
      // Note: We do not ignore width mismatch in this example.
</span><span class="tlx_structure">`include &quot;top_gen.sv&quot; </span><span class="tlx_comments">//_\TLV

   //_|bank
      //_@0
         </span><span class="tlx_logic">assign BANK_reset_a0 = reset;
      

      </span><span class="tlx_comments">// ----------------------------------------------------------------------------
      // Explicitly assign inputs.
      // Assign/randomize initial balance, account action, and amount to deposit or withdraw
      // ----------------------------------------------------------------------------
      //_@1
         </span><span class="tlx_logic">assign BANK_init_balance_a1[15:0] = 16'b1; </span><span class="tlx_comments">// initial balance
         </span><span class="tlx_logic">assign BANK_action_a1[0:0] = RW_rand_vect[(0 + (0)) % 257 +: 1];       </span><span class="tlx_comments">// deposit = 0; withdrawal = 1
         </span><span class="tlx_logic">assign BANK_transaction_a1[1:0] = RW_rand_vect[(124 + (0)) % 257 +: 2];  </span><span class="tlx_comments">// 75% chance of valid (01, 10, 11); 25% chance of invalid (00)
         </span><span class="tlx_logic">assign BANK_rand_amount_a1[10:0] = RW_rand_vect[(248 + (0)) % 257 +: 11]; </span><span class="tlx_comments">// amount to deposit or withdraw
         </span><span class="tlx_logic">assign BANK_amount_a1[15:0] = {5'b0, BANK_rand_amount_a1};


      </span><span class="tlx_comments">// ---
      // DUT
      // ---
      //_@2
         </span><span class="tlx_logic">assign BANK_valid_transaction_a2 = BANK_transaction_a2 != 2'b0;
         assign BANK_withdraw_error_a2 = BANK_action_a2 == 1'b1 &amp;&amp; BANK_amount_a2 &gt; BANK_Balance_a2 ? 1'b1 : </span><span class="tlx_comments">// true if withdrawal amount is greater than current balance
                                                                   </span><span class="tlx_logic">1'b0;  </span><span class="tlx_comments">// false otherwise
         </span><span class="tlx_logic">assign BANK_valid_transaction_or_reset_a2 = (BANK_valid_transaction_a2 &amp;&amp; !BANK_withdraw_error_a2) || BANK_reset_a2;
         
         </span><span class="tlx_comments">//_?$valid_transaction_or_reset
            </span><span class="tlx_logic">assign BANK_Balance_a1[15:0] = BANK_reset_a2          ? BANK_init_balance_a2 :      </span><span class="tlx_comments">// set to init_balance at the beginning
                              </span><span class="tlx_logic">BANK_action_a2 == 1'b0 ? BANK_Balance_a2 + BANK_amount_a2 : </span><span class="tlx_comments">// deposit amount
                                                </span><span class="tlx_logic">BANK_Balance_a2 - BANK_amount_a2;  </span><span class="tlx_comments">// withdraw amount
            
            //$NumTransactions[15:0] = 16'b0; to count how many successful transactions occur.
            </span><span class="tlx_logic">assign BANK_NumTransactions_a1[15:0] = BANK_reset_a2 ? 16'b0 :BANK_NumTransactions_a2 + 16'b1;

      </span><span class="tlx_comments">// -----------------
      // Print transaction
      // -----------------
      //_@3
         /*SV_plus*/
            </span><span class="tlx_logic">always_ff @(posedge clk) begin
               if (BANK_valid_transaction_a3 &amp;&amp; ! BANK_reset_a3) begin
                  if (!BANK_withdraw_error_a3) begin
                     $display(&quot; NumTransaction #: %0d&quot;, BANK_NumTransactions_a3);
                     $display(&quot;     $%5d %0s $%4d = $%5d&quot;, BANK_Balance_a3, BANK_action_a3 == 1'b0 ? &quot;+&quot; : &quot;-&quot;, BANK_amount_a3, BANK_Balance_a2);
                  end else begin
                     $display(&quot; Insufficient funds. Balance: $%5d Withdrawal: $%4d&quot;, BANK_Balance_a2, BANK_amount_a3);
                  end
               end
            end
      

      </span><span class="tlx_comments">// ---------------------------------------------------
      // Test for Positive Remaining Balance after 20 Cycles
      // ---------------------------------------------------
      //_@4
         </span><span class="tlx_logic">assign BANK_CycCount_a3[15:0] = BANK_reset_a4 ? 16'b0 : BANK_CycCount_a4 + 16'b1;
           
         assign passed = BANK_Balance_a4[15] == 1'b0 &amp;&amp; BANK_CycCount_a4 &gt; 16'd20; </span><span class="tlx_structure">endgenerate

</span><span class="tlx_comments">//_\SV
</span><span class="tlx_untouched">endmodule
</span>
</pre>
        </div>
    </div>
    <canvas id="overlay" width="280" height="200">
    </canvas>
    <svg id="sp_svg" x="429" y="430" width="112" height="40">
      <rect id="sp_rect" x="2" y="2" width="108" height="36" rx="10" ry="10" />
      <text id="sp_text" x="7" y="25" textLength="98">SandPiper</text>
    </svg>

</body>
</html>
