<!DOCTYPE html>
<html>
<head>
   <meta charset="utf-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
   <meta http-equiv="description" content="index.html">
   <meta http-equiv="keywords" content="tl-verilog">

   <title>top.m4 -> top.sv & top_gen.sv</title>

   <link rel="stylesheet" href="tlx.css" />
<!--Load styles for stats page-->
<link rel="stylesheet" href="http://www.rweda.com/lib/sp_1.9-2018_02_11-beta/stats.css" />
<!--Load the AJAX API-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript" src="http://www.rweda.com/lib/sp_1.9-2018_02_11-beta/stats.js"></script>
<script type="text/javascript">

  function getTitle() {
    return "top.m4 -> top.sv & top_gen.sv";
  }

  function chartData() {
    return [
      ['File(s)', 'Unknown', 'Untouched', 'Logic', 'Declarations', 'Staging', 'Structure', 'Validity', 'Gating', '(Instrumentation)', { role: 'style' }, '(Comments)', { role: 'style' }, '(Whitespace)', { role: 'style' }],
      ['top.m4', 0, 305, 469, 0, 8, 48, 14, 0, 0, 'opacity: 0.1', 1025, 'opacity: 0.1', 517, 'opacity: 0.1'],
      ['top.sv', 0, 305, 651, 0, 0, 73, 0, 0, 0, 'opacity: 0.1', 1166, 'opacity: 0.1', 535, 'opacity: 0.1'],
      ['top_gen.sv', 0, 0, 0, 373, 1016, 72, 0, 380, 402, 'opacity: 0.1', 751, 'opacity: 0.1', 869, 'opacity: 0.1'],
      ['SV Total', 0, 305, 651, 373, 1016, 145, 0, 380, 402, 'opacity: 0.1', 1917, 'opacity: 0.1', 1404, 'opacity: 0.1']
    ];
  }

  function chartColors() {
    return ['DarkGray', '#305050', 'purple', 'blue', '#509050', '#1090c0', '#E04010', 'orange', '#C0C0F0', '#C04040', 'gray'];
  };
</script>
</head>

<body>

    <div id="four_square">
        <div id="chart_div" class="cell left top"></div>
        <div id="gen_div" class="cell code right top">
<h2>top_gen.sv</h2>

<pre>
<span class="tlx_comments">// Generated by SandPiper(TM) 1.9-2018/02/11-beta from Redwood EDA.
// (Installed here: /home/devel/SandPiper_1.9-2018_02_11-beta_distro.)
// Redwood EDA does not claim intellectual property rights to this file and provides no warranty regarding its correctness or quality.


</span><span class="tlx_structure">`include &quot;sandpiper_gen.vh&quot;





</span><span class="tlx_comments">//
// Signals declared top-level.
//

// For |in$cnt.
</span><span class="tlx_declarations">logic [1:0] IN_cnt_a0,
            IN_cnt_a1;

</span><span class="tlx_comments">// For |in$error.
</span><span class="tlx_declarations">logic IN_error_a4,
      IN_error_a5;

</span><span class="tlx_comments">// For |in$flit.
</span><span class="tlx_declarations">logic [3:0] IN_flit_a0,
            IN_flit_a1,
            IN_flit_a2,
            IN_flit_a3,
            IN_flit_a4;

</span><span class="tlx_comments">// For |in$packet_in.
</span><span class="tlx_declarations">logic [15:0] IN_packet_in_a0,
             IN_packet_in_a1,
             IN_packet_in_a2,
             IN_packet_in_a3,
             IN_packet_in_a4;

</span><span class="tlx_comments">// For |in$packet_out.
</span><span class="tlx_declarations">logic [15:0] IN_packet_out_a4;

</span><span class="tlx_comments">// For |in$reset.
</span><span class="tlx_declarations">logic IN_reset_a0,
      IN_reset_a1,
      IN_reset_a2,
      IN_reset_a3,
      IN_reset_a4;

</span><span class="tlx_comments">// For |in$valid.
</span><span class="tlx_declarations">logic IN_valid_a0,
      IN_valid_a1,
      IN_valid_a2,
      IN_valid_a3,
      IN_valid_a4;

</span><span class="tlx_comments">
//
// Scope: |in
//

// Clock signals.
</span><span class="tlx_gating">logic clkP_IN_valid_a1 ;
logic clkP_IN_valid_a2 ;
logic clkP_IN_valid_a3 ;
logic clkP_IN_valid_a4 ;

</span><span class="tlx_structure">
generate
</span><span class="tlx_comments">

   //
   // Scope: |in
   //

      // For $cnt.
      </span><span class="tlx_staging">always_ff @(posedge clk) IN_cnt_a1[1:0] &lt;= IN_cnt_a0[1:0];

      </span><span class="tlx_comments">// For $error.
      </span><span class="tlx_staging">always_ff @(posedge clk) IN_error_a5 &lt;= IN_error_a4;

      </span><span class="tlx_comments">// For $flit.
      </span><span class="tlx_staging">always_ff @(posedge clk) IN_flit_a1[3:0] &lt;= IN_flit_a0[3:0];
      always_ff @(posedge clk) IN_flit_a2[3:0] &lt;= IN_flit_a1[3:0];
      always_ff @(posedge clk) IN_flit_a3[3:0] &lt;= IN_flit_a2[3:0];
      always_ff @(posedge clk) IN_flit_a4[3:0] &lt;= IN_flit_a3[3:0];

      </span><span class="tlx_comments">// For $packet_in.
      </span><span class="tlx_staging">always_ff @(posedge clkP_IN_valid_a1) IN_packet_in_a1[15:0] &lt;= IN_packet_in_a0[15:0];
      always_ff @(posedge clkP_IN_valid_a2) IN_packet_in_a2[15:0] &lt;= IN_packet_in_a1[15:0];
      always_ff @(posedge clkP_IN_valid_a3) IN_packet_in_a3[15:0] &lt;= IN_packet_in_a2[15:0];
      always_ff @(posedge clkP_IN_valid_a4) IN_packet_in_a4[15:0] &lt;= IN_packet_in_a3[15:0];

      </span><span class="tlx_comments">// For $reset.
      </span><span class="tlx_staging">always_ff @(posedge clk) IN_reset_a1 &lt;= IN_reset_a0;
      always_ff @(posedge clk) IN_reset_a2 &lt;= IN_reset_a1;
      always_ff @(posedge clk) IN_reset_a3 &lt;= IN_reset_a2;
      always_ff @(posedge clk) IN_reset_a4 &lt;= IN_reset_a3;

      </span><span class="tlx_comments">// For $valid.
      </span><span class="tlx_staging">always_ff @(posedge clk) IN_valid_a1 &lt;= IN_valid_a0;
      always_ff @(posedge clk) IN_valid_a2 &lt;= IN_valid_a1;
      always_ff @(posedge clk) IN_valid_a3 &lt;= IN_valid_a2;
      always_ff @(posedge clk) IN_valid_a4 &lt;= IN_valid_a3;




</span><span class="tlx_structure">endgenerate



</span><span class="tlx_comments">//
// Gated clocks.
//

</span><span class="tlx_structure">generate

</span><span class="tlx_comments">

   //
   // Scope: |in
   //

</span><span class="tlx_gating">      clk_gate gen_clkP_IN_valid_a1(clkP_IN_valid_a1, clk, 1'b1, IN_valid_a0, 1'b0);
      clk_gate gen_clkP_IN_valid_a2(clkP_IN_valid_a2, clk, 1'b1, IN_valid_a1, 1'b0);
      clk_gate gen_clkP_IN_valid_a3(clkP_IN_valid_a3, clk, 1'b1, IN_valid_a2, 1'b0);
      clk_gate gen_clkP_IN_valid_a4(clkP_IN_valid_a4, clk, 1'b1, IN_valid_a3, 1'b0);



</span><span class="tlx_structure">endgenerate



</span><span class="tlx_comments">//
// Debug Signals
//

</span><span class="tlx_instrumentation">generate

   if (1) begin : DEBUG_SIGS
</span><span class="tlx_comments">

      //
      // Scope: |in
      //
      </span><span class="tlx_instrumentation">if (1) begin : \|in 
         logic [1:0] \@0$cnt ;
         assign \@0$cnt = IN_cnt_a0;
         logic  \@4$error ;
         assign \@4$error = IN_error_a4;
         logic [3:0] \@0$flit ;
         assign \@0$flit = IN_flit_a0;
         logic [15:0] \@0$packet_in ;
         assign \@0$packet_in = IN_packet_in_a0;
         logic [15:0] \@4$packet_out ;
         assign \@4$packet_out = IN_packet_out_a4;
         logic  \@0$reset ;
         assign \@0$reset = IN_reset_a0;
         logic  \@0$valid ;
         assign \@0$valid = IN_valid_a0;
      end


   end

endgenerate




</span><span class="tlx_structure">generate   </span><span class="tlx_comments">// This is awkward, but we need to go into 'generate' context in the line that `includes the declarations file.
</span>
</pre>
        </div>
        <div id="tlx_div" class="cell code left bottom">
<h2>top.m4</h2>

<pre>
<span class="tlx_structure">\TLV_version 1d: tl-x.org
\SV
   </span><span class="tlx_untouched">`include &quot;sqrt32.v&quot;;
   
   </span><span class="tlx_comments">// =============================================
   // Time-Division Multiplexer and De-multiplexing
   // =============================================

   // A wide vector, at a 1/4 &quot;frequency&quot; (1 valid cycle, followed by 3 invalid ones)
   // is time-division multiplexed (TDM) into a narrow vector, carrying one of n pieces per cycle,
   // (1st, least-significant flit in stage 0, 2nd in stage 2, etc.)
   // and this is de-multiplexed into a stream similar to the original in the same pipeline.
   // This is a useful design pattern for reducing wire routing.

   </span><span class="tlx_untouched">module top(input logic clk, input logic reset, input logic [31:0] cyc_cnt, output logic passed, output logic failed);    </span><span class="tlx_comments">/* verilator lint_save */ /* verilator lint_off UNOPTFLAT */  </span><span class="tlx_untouched">bit [256:0] RW_rand_raw; bit [256+63:0] RW_rand_vect; pseudo_rand #(.WIDTH(257)) pseudo_rand (clk, reset, RW_rand_raw[256:0]); assign RW_rand_vect[256+63:0] = {RW_rand_raw[62:0], RW_rand_raw};  </span><span class="tlx_comments">/* verilator lint_restore */  /* verilator lint_off WIDTH */ /* verilator lint_off UNOPTFLAT */
</span><span class="tlx_structure">\TLV
   
   </span><span class="tlx_comments">// Stimulus
   </span><span class="tlx_structure">|in
      </span><span class="tlx_staging">@0
         </span><span class="tlx_comments">// Control signals
         </span><span class="tlx_logic">$reset = *reset;
         $cnt[1:0] = $reset ? 0 : &gt;&gt;1$cnt + 1;
         $valid = $cnt == 0 &amp;&amp; ! $reset;
      </span><span class="tlx_comments">// Random wide input vector, valid every nth cycle.
      </span><span class="tlx_validity">?$valid
         </span><span class="tlx_staging">@0
            </span><span class="tlx_logic">$packet_in[15:0] = *RW_rand_vect[(0 + (0)) % 257 +: 16];
      </span><span class="tlx_comments">// TDM the wide vector into narrow pieces.
      </span><span class="tlx_staging">@0
         </span><span class="tlx_logic">$flit[3:0] = &gt;&gt;0$valid ? &gt;&gt;0$packet_in[3:0] :
                      &gt;&gt;1$valid ? &gt;&gt;1$packet_in[7:4] :
                      &gt;&gt;2$valid ? &gt;&gt;2$packet_in[11:8] :
                                  &gt;&gt;3$packet_in[15:12];
      </span><span class="tlx_comments">// Reassemble (de-multiplex) the data into its original wide form in a
      // different pipeline.
      </span><span class="tlx_staging">@4  </span><span class="tlx_comments">// 3 or more. Increase to add transit time.
         </span><span class="tlx_validity">?$valid
            </span><span class="tlx_logic">$packet_out[15:0] = {&lt;&lt;3$flit, &lt;&lt;2$flit, &lt;&lt;1$flit, &lt;&gt;0$flit};

         </span><span class="tlx_comments">// Print &amp; check
         </span><span class="tlx_structure">\always_comb
            </span><span class="tlx_logic">if ($valid)
               \$display(&quot;\%h became \%h&quot;, $packet_in, $packet_out);
         $error = $reset ? 0 : &gt;&gt;1$error || ($valid &amp;&amp; ($packet_in != $packet_out));
   
   
         </span><span class="tlx_comments">// Assert these to end simulation (before Makerchip cycle limit).
         </span><span class="tlx_logic">*passed = *cyc_cnt &gt; 40;
         *failed = *cyc_cnt &gt; 30 &amp;&amp; $valid &amp;&amp; $error;

</span><span class="tlx_structure">\SV
   </span><span class="tlx_untouched">endmodule
</span>
</pre>
        </div>
        <div id="trans_div" class="cell code right bottom">
<h2>top.sv</h2>

<pre>
<span class="tlx_structure">`line 2 &quot;top.tlv&quot; 0 </span><span class="tlx_comments">//_\TLV_version 1d: tl-x.org, generated by SandPiper(TM) 1.9-2018/02/11-beta
</span><span class="tlx_structure">`include &quot;sp_default.vh&quot; </span><span class="tlx_comments">//_\SV
   </span><span class="tlx_untouched">`include &quot;sqrt32.v&quot;;
   
   </span><span class="tlx_comments">// =============================================
   // Time-Division Multiplexer and De-multiplexing
   // =============================================

   // A wide vector, at a 1/4 &quot;frequency&quot; (1 valid cycle, followed by 3 invalid ones)
   // is time-division multiplexed (TDM) into a narrow vector, carrying one of n pieces per cycle,
   // (1st, least-significant flit in stage 0, 2nd in stage 2, etc.)
   // and this is de-multiplexed into a stream similar to the original in the same pipeline.
   // This is a useful design pattern for reducing wire routing.

   </span><span class="tlx_untouched">module top(input logic clk, input logic reset, input logic [31:0] cyc_cnt, output logic passed, output logic failed);    </span><span class="tlx_comments">/* verilator lint_save */ /* verilator lint_off UNOPTFLAT */  </span><span class="tlx_untouched">bit [256:0] RW_rand_raw; bit [256+63:0] RW_rand_vect; pseudo_rand #(.WIDTH(257)) pseudo_rand (clk, reset, RW_rand_raw[256:0]); assign RW_rand_vect[256+63:0] = {RW_rand_raw[62:0], RW_rand_raw};  </span><span class="tlx_comments">/* verilator lint_restore */  /* verilator lint_off WIDTH */ /* verilator lint_off UNOPTFLAT */
</span><span class="tlx_structure">`include &quot;top_gen.sv&quot; </span><span class="tlx_comments">//_\TLV
   
   // Stimulus
   //_|in
      //_@0
         // Control signals
         </span><span class="tlx_logic">assign IN_reset_a0 = reset;
         assign IN_cnt_a0[1:0] = IN_reset_a0 ? 0 : IN_cnt_a1 + 1;
         assign IN_valid_a0 = IN_cnt_a0 == 0 &amp;&amp; ! IN_reset_a0;
      </span><span class="tlx_comments">// Random wide input vector, valid every nth cycle.
      //_?$valid
         //_@0
            </span><span class="tlx_logic">assign IN_packet_in_a0[15:0] = RW_rand_vect[(0 + (0)) % 257 +: 16];
      </span><span class="tlx_comments">// TDM the wide vector into narrow pieces.
      //_@0
         </span><span class="tlx_logic">assign IN_flit_a0[3:0] = IN_valid_a0 ? IN_packet_in_a0[3:0] :
                      IN_valid_a1 ? IN_packet_in_a1[7:4] :
                      IN_valid_a2 ? IN_packet_in_a2[11:8] :
                                  IN_packet_in_a3[15:12];
      </span><span class="tlx_comments">// Reassemble (de-multiplex) the data into its original wide form in a
      // different pipeline.
      //_@4  // 3 or more. Increase to add transit time.
         //_?$valid
            </span><span class="tlx_logic">assign IN_packet_out_a4[15:0] = {IN_flit_a1, IN_flit_a2, IN_flit_a3, IN_flit_a4};

         </span><span class="tlx_comments">// Print &amp; check
         </span><span class="tlx_logic">always_comb begin
            if (IN_valid_a4)
               $display(&quot;%h became %h&quot;, IN_packet_in_a4, IN_packet_out_a4); </span><span class="tlx_structure">end
         </span><span class="tlx_logic">assign IN_error_a4 = IN_reset_a4 ? 0 : IN_error_a5 || (IN_valid_a4 &amp;&amp; (IN_packet_in_a4 != IN_packet_out_a4));
   
   
         </span><span class="tlx_comments">// Assert these to end simulation (before Makerchip cycle limit).
         </span><span class="tlx_logic">assign passed = cyc_cnt &gt; 40;
         assign failed = cyc_cnt &gt; 30 &amp;&amp; IN_valid_a4 &amp;&amp; IN_error_a4; </span><span class="tlx_structure">endgenerate

</span><span class="tlx_comments">//_\SV
   </span><span class="tlx_untouched">endmodule
</span>
</pre>
        </div>
    </div>
    <canvas id="overlay" width="280" height="200">
    </canvas>
    <svg id="sp_svg" x="429" y="430" width="112" height="40">
      <rect id="sp_rect" x="2" y="2" width="108" height="36" rx="10" ry="10" />
      <text id="sp_text" x="7" y="25" textLength="98">SandPiper</text>
    </svg>

</body>
</html>
