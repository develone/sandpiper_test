<!DOCTYPE html>
<html>
<head>
   <meta charset="utf-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
   <meta http-equiv="description" content="top.html">
   <meta http-equiv="keywords" content="tl-verilog">

   <title>top.m4</title>

   <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
   <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css">
   <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
   <script src="http://www.rweda.com/lib/sp_1.9-2018_02_11-beta/ide.js"></script>
   <link rel="stylesheet" href="http://www.rweda.com/lib/sp_1.9-2018_02_11-beta/ide.css" />

<style>
/*
Copyright (c) 2015, Steven F. Hoover
All rights reserved.
*/
.tlv_ident_error {
  color: red;
  font-style: normal;
  font-weight: normal;
}
.tlv_ident_pipeline {
  color: orange;
  font-style: normal;
  font-weight: normal;
}
.tlv_ident_beh_hier_1 {
  color: #1090c0;
  font-style: normal;
  font-weight: normal;
}
.tlv_ident_beh_hier_2 {
  color: #1090c0;
  font-style: normal;
  font-weight: normal;
}
.tlv_ident_grouping {
  color: #1090c0;
  font-style: normal;
  font-weight: normal;
}
.tlv_ident_pipe_sig {
  color: purple;
  font-style: normal;
  font-weight: normal;
}
.tlv_ident_state_sig {
  color: purple;
  font-style: normal;
  font-weight: normal;
}
.tlv_ident_sig_keyword {
  color: purple;
  font-style: normal;
  font-weight: normal;
}
.tlv_ident_assigned_pipe_sig {
  color: purple;
  font-style: normal;
  font-weight: 600;
}
.tlv_ident_assigned_state_sig {
  color: purple;
  font-style: normal;
  font-weight: 600;
}
.tlv_ident_assigned_sig_keyword {
  color: purple;
  font-style: normal;
  font-weight: 600;
}
.tlv_ident_malformed_sig {
  color: purple;
  font-style: normal;
  font-weight: normal;
}
.tlv_ident_malformed_assigned_sig {
  color: purple;
  font-style: normal;
  font-weight: 600;
}
.tlv_ident_when {
  color: #E04010;
  font-style: normal;
  font-weight: normal;
}
.tlv_ident_sv_when {
  color: #E04010;
  font-style: normal;
  font-weight: normal;
}
.tlv_ident_phys_hier {
  color: blue;
  font-style: italic;
  font-weight: normal;
}
.tlv_ident_phys_beh_hier {
  color: #1090c0;
  font-style: normal;
  font-weight: normal;
}
.tlv_ident_stage_name {
  color: #509050;
  font-style: italic;
  font-weight: normal;
}
.tlv_ident_stage_expr {
  color: #509050;
  font-style: italic;
  font-weight: normal;
}
.tlv_ident_stage_next_operator {
  color: #509050;
  font-style: italic;
  font-weight: normal;
}
.tlv_ident_stage_incr_expr {
  color: #509050;
  font-style: italic;
  font-weight: normal;
}
.tlv_ident_stage_prev_operator {
  color: #509050;
  font-style: italic;
  font-weight: normal;
}
.tlv_ident_stage_decr_expr {
  color: #509050;
  font-style: italic;
  font-weight: normal;
}
.tlv_ident_alignment_expr_1ab {
  color: #00D000;
  font-style: normal;
  font-weight: 600;
}
.tlv_ident_alignment_expr_1c {
  color: #00D000;
  font-style: normal;
  font-weight: 600;
}
.tlv_ident_alignment_keyword_1c {
  color: #00D000;
  font-style: normal;
  font-weight: 600;
}
.tlv_ident_alignment_ahead_expr {
  color: #00D000;
  font-style: normal;
  font-weight: 600;
}
.tlv_ident_alignment_behind_expr {
  color: #00D000;
  font-style: normal;
  font-weight: 600;
}
.tlv_ident_alignment_zero_expr {
  color: #00D000;
  font-style: normal;
  font-weight: 600;
}
.tlv_ident_alignment_crosspipe_name {
  color: #00D000;
  font-style: normal;
  font-weight: 600;
}
.tlv_ident_alignment_ahead_name {
  color: #00D000;
  font-style: normal;
  font-weight: 600;
}
.tlv_ident_alignment_behind_name {
  color: #00D000;
  font-style: normal;
  font-weight: 600;
}
.tlv_ident_tlv_attribute {
  color: #503890;
  font-style: italic;
  font-weight: normal;
}
.tlv_ident_proj_rtl_attribute {
  color: #503890;
  font-style: italic;
  font-weight: normal;
}
.tlv_ident_misc_rtl_attribute {
  color: #503890;
  font-style: italic;
  font-weight: normal;
}
.tlv_ident_proj_attribute {
  color: #503890;
  font-style: italic;
  font-weight: normal;
}
.tlv_ident_sv_sig {
  color: #00008b;
  font-style: normal;
  font-weight: normal;
}
.tlv_ident_sv_datatype {
  color: DarkRed;
  font-style: normal;
  font-weight: normal;
}
.tlv_ident_keyword1 {
  color: Blue;
  font-style: normal;
  font-weight: normal;
}
.tlv_ident_comment {
  color: #808080;
  font-style: italic;
  font-weight: 600;
}
.tlv_ident_hdl_code {
  color: #00008b;
  font-style: normal;
  font-weight: normal;
}

</style>

</head>

<body>

<h2>top.m4</h2>

<pre>
<span class="line" line-num="1" source-line-num="1"><span class="tlv_ident_keyword1">\TLV_version 1d: tl-x.org</span></span>
<span class="line" line-num="2" source-line-num="2"><span class="tlv_ident_keyword1">\SV</span></span>
<span class="line" line-num="3" source-line-num="3">   <span class="tlv_ident_hdl_code">`include &quot;sqrt32.v&quot;;</span></span>
<span class="line" line-num="4" source-line-num="4">   </span>
<span class="line" line-num="5" source-line-num="5">   <span class="tlv_ident_comment">// =============================================</span></span>
<span class="line" line-num="6" source-line-num="6">   <span class="tlv_ident_comment">// Time-Division Multiplexer and De-multiplexing</span></span>
<span class="line" line-num="7" source-line-num="7">   <span class="tlv_ident_comment">// =============================================</span></span>
<span class="line" line-num="8" source-line-num="8"></span>
<span class="line" line-num="9" source-line-num="9">   <span class="tlv_ident_comment">// A wide vector, at a 1/4 &quot;frequency&quot; (1 valid cycle, followed by 3 invalid ones)</span></span>
<span class="line" line-num="10" source-line-num="10">   <span class="tlv_ident_comment">// is time-division multiplexed (TDM) into a narrow vector, carrying one of n pieces per cycle,</span></span>
<span class="line" line-num="11" source-line-num="11">   <span class="tlv_ident_comment">// (1st, least-significant flit in stage 0, 2nd in stage 2, etc.)</span></span>
<span class="line" line-num="12" source-line-num="12">   <span class="tlv_ident_comment">// and this is de-multiplexed into a stream similar to the original in the same pipeline.</span></span>
<span class="line" line-num="13" source-line-num="13">   <span class="tlv_ident_comment">// This is a useful design pattern for reducing wire routing.</span></span>
<span class="line" line-num="14" source-line-num="14"></span>
<span class="line" line-num="15" source-line-num="15">   <span class="tlv_ident_hdl_code">module top(input logic clk, input logic reset, input logic [31:0] cyc_cnt, output logic passed, output logic failed);    </span><span class="tlv_ident_comment">/* verilator lint_save */ /* verilator lint_off UNOPTFLAT */  </span><span class="tlv_ident_hdl_code">bit [256:0] RW_rand_raw; bit [256+63:0] RW_rand_vect; pseudo_rand #(.WIDTH(257)) pseudo_rand (clk, reset, RW_rand_raw[256:0]); assign RW_rand_vect[256+63:0] = {RW_rand_raw[62:0], RW_rand_raw};  </span><span class="tlv_ident_comment">/* verilator lint_restore */  /* verilator lint_off WIDTH */ /* verilator lint_off UNOPTFLAT */</span></span>
<span class="line" line-num="16" source-line-num="16"><span class="tlv_ident_keyword1">\TLV</span></span>
<span class="line" line-num="17" source-line-num="17">   </span>
<span class="line" line-num="18" source-line-num="18">   <span class="tlv_ident_comment">// Stimulus</span></span>
<span class="line" line-num="19" source-line-num="19">   <span class="tlv_ident_pipeline" logical_entity="|in">|in</span></span>
<span class="line" line-num="20" source-line-num="20">      <span class="tlv_ident_stage_expr" logical_entity="|in@0">@0</span></span>
<span class="line" line-num="21" source-line-num="21">         <span class="tlv_ident_comment">// Control signals</span></span>
<span class="line" line-num="22" source-line-num="22">         <span class="tlv_ident_assigned_pipe_sig" logical_entity="|in$reset">$reset</span> <span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_sv_sig">*</span><span class="tlv_ident_hdl_code">reset;</span></span>
<span class="line" line-num="23" source-line-num="23">         <span class="tlv_ident_assigned_pipe_sig" logical_entity="|in$cnt">$cnt</span><span class="tlv_ident_pipe_sig">[</span><span class="tlv_ident_hdl_code">1</span><span class="tlv_ident_pipe_sig">:</span><span class="tlv_ident_hdl_code">0</span><span class="tlv_ident_pipe_sig">] </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_pipe_sig" logical_entity="|in$reset">$reset</span> <span class="tlv_ident_hdl_code">? 0 : </span><span class="tlv_ident_alignment_ahead_expr" logical_entity="|in@2">&gt;&gt;1</span><span class="tlv_ident_pipe_sig" logical_entity="|in$cnt">$cnt</span> <span class="tlv_ident_hdl_code">+ 1;</span></span>
<span class="line" line-num="24" source-line-num="24">         <span class="tlv_ident_assigned_pipe_sig" logical_entity="|in$valid">$valid</span> <span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_pipe_sig" logical_entity="|in$cnt">$cnt</span> <span class="tlv_ident_hdl_code">== 0 &amp;&amp; ! </span><span class="tlv_ident_pipe_sig" logical_entity="|in$reset">$reset</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="25" source-line-num="25">      <span class="tlv_ident_comment">// Random wide input vector, valid every nth cycle.</span></span>
<span class="line" line-num="26" source-line-num="26">      <span class="tlv_ident_when">?$valid</span></span>
<span class="line" line-num="27" source-line-num="27">         <span class="tlv_ident_stage_expr" logical_entity="|in@0">@0</span></span>
<span class="line" line-num="28" source-line-num="28">            <span class="tlv_ident_assigned_pipe_sig" logical_entity="|in$packet_in">$packet_in</span><span class="tlv_ident_pipe_sig">[</span><span class="tlv_ident_hdl_code">15</span><span class="tlv_ident_pipe_sig">:</span><span class="tlv_ident_hdl_code">0</span><span class="tlv_ident_pipe_sig">] </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_sv_sig">*</span><span class="tlv_ident_hdl_code">RW_rand_vect[(0 + (0)) % 257 +: 16];</span></span>
<span class="line" line-num="29" source-line-num="29">      <span class="tlv_ident_comment">// TDM the wide vector into narrow pieces.</span></span>
<span class="line" line-num="30" source-line-num="30">      <span class="tlv_ident_stage_expr" logical_entity="|in@0">@0</span></span>
<span class="line" line-num="31" source-line-num="31">         <span class="tlv_ident_assigned_pipe_sig" logical_entity="|in$flit">$flit</span><span class="tlv_ident_pipe_sig">[</span><span class="tlv_ident_hdl_code">3</span><span class="tlv_ident_pipe_sig">:</span><span class="tlv_ident_hdl_code">0</span><span class="tlv_ident_pipe_sig">] </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_alignment_ahead_expr" logical_entity="|in@0">&gt;&gt;0</span><span class="tlv_ident_pipe_sig" logical_entity="|in$valid">$valid</span> <span class="tlv_ident_hdl_code">? </span><span class="tlv_ident_alignment_ahead_expr" logical_entity="|in@0">&gt;&gt;0</span><span class="tlv_ident_pipe_sig" logical_entity="|in$packet_in">$packet_in</span><span class="tlv_ident_pipe_sig">[</span><span class="tlv_ident_hdl_code">3</span><span class="tlv_ident_pipe_sig">:</span><span class="tlv_ident_hdl_code">0</span><span class="tlv_ident_pipe_sig">] </span><span class="tlv_ident_hdl_code">:</span></span>
<span class="line" line-num="32" source-line-num="32">                      <span class="tlv_ident_alignment_ahead_expr" logical_entity="|in@2">&gt;&gt;1</span><span class="tlv_ident_pipe_sig" logical_entity="|in$valid">$valid</span> <span class="tlv_ident_hdl_code">? </span><span class="tlv_ident_alignment_ahead_expr" logical_entity="|in@2">&gt;&gt;1</span><span class="tlv_ident_pipe_sig" logical_entity="|in$packet_in">$packet_in</span><span class="tlv_ident_pipe_sig">[</span><span class="tlv_ident_hdl_code">7</span><span class="tlv_ident_pipe_sig">:</span><span class="tlv_ident_hdl_code">4</span><span class="tlv_ident_pipe_sig">] </span><span class="tlv_ident_hdl_code">:</span></span>
<span class="line" line-num="33" source-line-num="33">                      <span class="tlv_ident_alignment_ahead_expr" logical_entity="|in@4">&gt;&gt;2</span><span class="tlv_ident_pipe_sig" logical_entity="|in$valid">$valid</span> <span class="tlv_ident_hdl_code">? </span><span class="tlv_ident_alignment_ahead_expr" logical_entity="|in@4">&gt;&gt;2</span><span class="tlv_ident_pipe_sig" logical_entity="|in$packet_in">$packet_in</span><span class="tlv_ident_pipe_sig">[</span><span class="tlv_ident_hdl_code">11</span><span class="tlv_ident_pipe_sig">:</span><span class="tlv_ident_hdl_code">8</span><span class="tlv_ident_pipe_sig">] </span><span class="tlv_ident_hdl_code">:</span></span>
<span class="line" line-num="34" source-line-num="34">                                  <span class="tlv_ident_alignment_ahead_expr" logical_entity="|in@6">&gt;&gt;3</span><span class="tlv_ident_pipe_sig" logical_entity="|in$packet_in">$packet_in</span><span class="tlv_ident_pipe_sig">[</span><span class="tlv_ident_hdl_code">15</span><span class="tlv_ident_pipe_sig">:</span><span class="tlv_ident_hdl_code">12</span><span class="tlv_ident_pipe_sig">]</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="35" source-line-num="35">      <span class="tlv_ident_comment">// Reassemble (de-multiplex) the data into its original wide form in a</span></span>
<span class="line" line-num="36" source-line-num="36">      <span class="tlv_ident_comment">// different pipeline.</span></span>
<span class="line" line-num="37" source-line-num="37">      <span class="tlv_ident_stage_expr" logical_entity="|in@8">@4</span>  <span class="tlv_ident_comment">// 3 or more. Increase to add transit time.</span></span>
<span class="line" line-num="38" source-line-num="38">         <span class="tlv_ident_when">?$valid</span></span>
<span class="line" line-num="39" source-line-num="39">            <span class="tlv_ident_assigned_pipe_sig" logical_entity="|in$packet_out">$packet_out</span><span class="tlv_ident_pipe_sig">[</span><span class="tlv_ident_hdl_code">15</span><span class="tlv_ident_pipe_sig">:</span><span class="tlv_ident_hdl_code">0</span><span class="tlv_ident_pipe_sig">] </span><span class="tlv_ident_hdl_code">= {</span><span class="tlv_ident_alignment_behind_expr" logical_entity="|in@2">&lt;&lt;3</span><span class="tlv_ident_pipe_sig" logical_entity="|in$flit">$flit</span><span class="tlv_ident_hdl_code">, </span><span class="tlv_ident_alignment_behind_expr" logical_entity="|in@4">&lt;&lt;2</span><span class="tlv_ident_pipe_sig" logical_entity="|in$flit">$flit</span><span class="tlv_ident_hdl_code">, </span><span class="tlv_ident_alignment_behind_expr" logical_entity="|in@6">&lt;&lt;1</span><span class="tlv_ident_pipe_sig" logical_entity="|in$flit">$flit</span><span class="tlv_ident_hdl_code">, </span><span class="tlv_ident_alignment_zero_expr" logical_entity="|in@8">&lt;&gt;0</span><span class="tlv_ident_pipe_sig" logical_entity="|in$flit">$flit</span><span class="tlv_ident_hdl_code">};</span></span>
<span class="line" line-num="40" source-line-num="40"></span>
<span class="line" line-num="41" source-line-num="41">         <span class="tlv_ident_comment">// Print &amp; check</span></span>
<span class="line" line-num="42" source-line-num="42">         <span class="tlv_ident_keyword1">\always_comb</span></span>
<span class="line" line-num="43" source-line-num="43">            <span class="tlv_ident_hdl_code">if (</span><span class="tlv_ident_pipe_sig" logical_entity="|in$valid">$valid</span><span class="tlv_ident_hdl_code">)</span></span>
<span class="line" line-num="44" source-line-num="44">               <span class="tlv_ident_sv_sig">\</span><span class="tlv_ident_hdl_code">$display(&quot;</span><span class="tlv_ident_sv_sig">\</span><span class="tlv_ident_hdl_code">%h became </span><span class="tlv_ident_sv_sig">\</span><span class="tlv_ident_hdl_code">%h&quot;, </span><span class="tlv_ident_pipe_sig" logical_entity="|in$packet_in">$packet_in</span><span class="tlv_ident_hdl_code">, </span><span class="tlv_ident_pipe_sig" logical_entity="|in$packet_out">$packet_out</span><span class="tlv_ident_hdl_code">);</span></span>
<span class="line" line-num="45" source-line-num="45">         <span class="tlv_ident_assigned_pipe_sig" logical_entity="|in$error">$error</span> <span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_pipe_sig" logical_entity="|in$reset">$reset</span> <span class="tlv_ident_hdl_code">? 0 : </span><span class="tlv_ident_alignment_ahead_expr" logical_entity="|in@10">&gt;&gt;1</span><span class="tlv_ident_pipe_sig" logical_entity="|in$error">$error</span> <span class="tlv_ident_hdl_code">|| (</span><span class="tlv_ident_pipe_sig" logical_entity="|in$valid">$valid</span> <span class="tlv_ident_hdl_code">&amp;&amp; (</span><span class="tlv_ident_pipe_sig" logical_entity="|in$packet_in">$packet_in</span> <span class="tlv_ident_hdl_code">!= </span><span class="tlv_ident_pipe_sig" logical_entity="|in$packet_out">$packet_out</span><span class="tlv_ident_hdl_code">));</span></span>
<span class="line" line-num="46" source-line-num="46">   </span>
<span class="line" line-num="47" source-line-num="47">   </span>
<span class="line" line-num="48" source-line-num="48">         <span class="tlv_ident_comment">// Assert these to end simulation (before Makerchip cycle limit).</span></span>
<span class="line" line-num="49" source-line-num="49">         <span class="tlv_ident_sv_sig">*</span><span class="tlv_ident_hdl_code">passed = </span><span class="tlv_ident_sv_sig">*</span><span class="tlv_ident_hdl_code">cyc_cnt &gt; 40;</span></span>
<span class="line" line-num="50" source-line-num="50">         <span class="tlv_ident_sv_sig">*</span><span class="tlv_ident_hdl_code">failed = </span><span class="tlv_ident_sv_sig">*</span><span class="tlv_ident_hdl_code">cyc_cnt &gt; 30 &amp;&amp; </span><span class="tlv_ident_pipe_sig" logical_entity="|in$valid">$valid</span> <span class="tlv_ident_hdl_code">&amp;&amp; </span><span class="tlv_ident_pipe_sig" logical_entity="|in$error">$error</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="51" source-line-num="51"></span>
<span class="line" line-num="52" source-line-num="52"><span class="tlv_ident_keyword1">\SV</span></span>
<span class="line" line-num="53" source-line-num="53">   <span class="tlv_ident_hdl_code">endmodule</span></span>

</pre>

</body>
</html>
